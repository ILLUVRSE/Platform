<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Lighthouse Defense</title>
  <style>
    body, html { margin: 0; padding: 0; background: #021014; color: #fff; overflow: hidden; font-family: Arial, sans-serif; }
    canvas { display: block; margin: 0 auto; background: linear-gradient(#01272f, #021014); }
    #hud { position: fixed; top: 8px; left: 8px; font-size: 14px; }
  </style>
</head>
<body>
  <canvas id="c" width="480" height="320"></canvas>
  <div id="hud">Beacons: <span id="beacons">3</span> â€¢ Waves: <span id="wave">1</span></div>
  <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const beaconsEl = document.getElementById('beacons');
    const waveEl = document.getElementById('wave');

    let beacons = [];
    let enemies = [];
    let beaconsRemaining = 3;
    let wave = 1;
    let ticks = 0;

    function spawnEnemy() {
      enemies.push({
        x: canvas.width + 20,
        y: Math.random() * (canvas.height - 20) + 10,
        hp: 60,
        speed: 0.8 + Math.random() * 0.6,
      });
    }

    function drawBackground() {
      ctx.fillStyle = '#021014';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#044b55';
      ctx.fillRect(0, canvas.height - 40, canvas.width, 40);
      ctx.fillStyle = '#0c1f24';
      ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
    }

    function drawLighthouse() {
      ctx.fillStyle = '#eee';
      ctx.fillRect(10, canvas.height - 90, 30, 70);
      ctx.fillStyle = '#ffd700';
      ctx.beginPath();
      ctx.arc(25, canvas.height - 90, 15, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawBeacons() {
      ctx.fillStyle = '#7fffd4';
      beacons.forEach((b) => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, 8, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function drawEnemies() {
      ctx.fillStyle = '#ff6b6b';
      enemies.forEach((e) => {
        ctx.beginPath();
        ctx.arc(e.x, e.y, 10, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function update() {
      ticks++;
      drawBackground();
      drawLighthouse();
      drawBeacons();
      drawEnemies();

      enemies.forEach((e) => {
        e.x -= e.speed;
        beacons.forEach((b) => {
          const dx = e.x - b.x;
          const dy = e.y - b.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < 80) {
            e.hp -= 0.6;
            ctx.strokeStyle = 'rgba(127,255,212,0.6)';
            ctx.beginPath();
            ctx.moveTo(b.x, b.y);
            ctx.lineTo(e.x, e.y);
            ctx.stroke();
          }
        });
      });

      enemies = enemies.filter((e) => e.hp > 0 && e.x > -15);

      if (ticks % 120 === 0) spawnEnemy();
      if (enemies.length === 0 && ticks > 600) {
        wave++;
        ticks = 0;
      }
      beaconsEl.textContent = beaconsRemaining;
      waveEl.textContent = wave;
      requestAnimationFrame(update);
    }

    canvas.addEventListener('click', (e) => {
      if (beaconsRemaining <= 0) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      beacons.push({ x, y });
      beaconsRemaining--;
    });

    update();
  </script>
</body>
</html>
